<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmes de Terror</title>
    <link rel="stylesheet" href="./SRC/css/reset.css">
    <link rel="stylesheet" href="./SRC/css/style.css">
    <link rel="stylesheet" href="./SRC/css/aparelhos.css">
    <script src="https://kit.fontawesome.com/9256129f72.js" crossorigin="anonymous"></script>
    <style>
        .adblock-message {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background-color: red;
            color: white;
            text-align: center;
            z-index: 1000;
        }
        .adblock-message a {
            color: yellow;
            text-decoration: underline;
        }
        .adblock-message button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="adblock-message" class="adblock-message">
        <span>Por favor, instale um AdBlock para evitar anúncios durante a navegação. Disponível na <a href="https://chrome.google.com/webstore/" target="_blank">Web Store</a> ou na <a href="https://play.google.com/store" target="_blank">Play Store</a>.</span>
        <button id="close-adblock-message">&times;</button>
    </div>
    <header>
        <a href="index.html">
            <div class="logo"></div>
        </a>
        <div class="pesquisar">
            <input type="text" id="searchInput" placeholder="Digite o seu filme de terror">
            <i class="fa-solid fa-magnifying-glass lupa" id="searchButton"></i>
        </div>
    </header>
    <main>
        <div id="movie-container">
            <!-- Os filmes de terror serão exibidos aqui -->
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="social-media">
                <a href="https://instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>
            <p>&copy; 2024 JPCINE. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC2U69m-BT92vckB_wzziSJB9F8cCB0YBo",
            authDomain: "filme-terror.firebaseapp.com",
            databaseURL: "https://filme-terror-default-rtdb.firebaseio.com",
            projectId: "filme-terror",
            storageBucket: "filme-terror.appspot.com",
            messagingSenderId: "700657136479",
            appId: "1:700657136479:web:6c42f535edd24bd25f7cea"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);

        // Referência ao Realtime Database
        const database = firebase.database();

        // Função para carregar os filmes do banco de dados
        async function loadFilmes() {
            try {
                const snapshot = await database.ref('filmes').once('value');
                return snapshot.val();
            } catch (error) {
                console.error('Erro ao carregar filmes:', error);
                throw error;
            }
        }

        // Função para exibir os filmes na página inicial
        async function exibirFilmes() {
            try {
                const filmes = await loadFilmes();
                const movieContainer = document.getElementById('movie-container');

                for (const key in filmes) {
                    if (Object.hasOwnProperty.call(filmes, key)) {
                        const filme = filmes[key];
                        const filmeElement = document.createElement('div');
                        filmeElement.classList.add('filme');

                        const logoImg = document.createElement('img');
                        logoImg.src = filme.logo;
                        logoImg.alt = filme.titulo;

                        const tituloElement = document.createElement('h3');
                        tituloElement.textContent = filme.titulo;

                        const descricaoElement = document.createElement('p');
                        descricaoElement.textContent = filme.descricao;

                        // Adiciona um evento de clique para redirecionar para player.html com os detalhes do filme
                        filmeElement.addEventListener('click', function() {
                            sessionStorage.setItem('filmeSelecionado', JSON.stringify(filme));
                            window.location.href = './player.html';
                        });

                        filmeElement.appendChild(logoImg);
                        filmeElement.appendChild(tituloElement);
                        filmeElement.appendChild(descricaoElement);

                        movieContainer.appendChild(filmeElement);
                    }
                }
            } catch (error) {
                console.error('Erro ao exibir filmes:', error);
            }
        }

        // Função para pesquisar filmes
        async function pesquisarFilmes() {
            const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
            const movieContainer = document.getElementById('movie-container');
            const loadingElement = document.createElement('div');
            loadingElement.classList.add('loading');
            loadingElement.innerHTML = '<div class="loading-circle"></div><p class="p-loading">Carregando filmes...</p>';
            movieContainer.innerHTML = '';
            movieContainer.appendChild(loadingElement);

            try {
                // Simulando um atraso de 6 segundos para o efeito de loading
                await new Promise(resolve => setTimeout(resolve, 6000));

                const filmes = await loadFilmes();
                const filmesFiltrados = Object.values(filmes).filter(filme =>
                    filme.titulo.toLowerCase().includes(searchInput)
                );

                movieContainer.innerHTML = '';

                if (filmesFiltrados.length > 0) {
                    filmesFiltrados.forEach(filme => {
                        const filmeElement = document.createElement('div');
                        filmeElement.classList.add('filme');

                        const logoImg = document.createElement('img');
                        logoImg.src = filme.logo;
                        logoImg.alt = filme.titulo;

                        const tituloElement = document.createElement('h3');
                        tituloElement.textContent = filme.titulo;

                        const descricaoElement = document.createElement('p');
                        descricaoElement.textContent = filme.descricao;

                        // Adiciona um evento de clique para redirecionar para player.html com os detalhes do filme
                        filmeElement.addEventListener('click', function() {
                            sessionStorage.setItem('filmeSelecionado', JSON.stringify(filme));
                            window.location.href = './player.html';
                        });

                        filmeElement.appendChild(logoImg);
                        filmeElement.appendChild(tituloElement);
                        filmeElement.appendChild(descricaoElement);

                        movieContainer.appendChild(filmeElement);
                    });
                } else {
                    const mensagemElement = document.createElement('p');
                    mensagemElement.textContent = 'Nenhum filme encontrado.';
                    movieContainer.appendChild(mensagemElement);
                }
            } catch (error) {
                console.error('Erro ao pesquisar filmes:', error);
            }
        }

        // Carrega e exibe os filmes ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            exibirFilmes();

            // Adiciona um listener para o input de pesquisa
            document.getElementById('searchInput').addEventListener('input', pesquisarFilmes);

            // Adiciona um listener para fechar a mensagem de adblock
            document.getElementById('close-adblock-message').addEventListener('click', function() {
                document.getElementById('adblock-message').style.display = 'none';
            });
        });



    </script>
</body>
</html>
