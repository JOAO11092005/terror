<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administração de Filmes</title>
    <link rel="stylesheet" href="./SRC/css/admin-style.css">
    <script src="https://kit.fontawesome.com/9256129f72.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="logo">
            Administração de Filmes
        </div>
    </header>
    <main>
        <section class="add-movie">
            <h2>Adicionar Novo Filme</h2>
            <form id="add-movie-form">
                <label for="title">Título:</label>
                <input type="text" id="title" name="title" required>
                
                <label for="description">Descrição:</label>
                <textarea id="description" name="description" required></textarea>
                
                <label for="logo">URL do Logo:</label>
                <input type="url" id="logo" name="logo" required>
                
                <label for="video">URL do Vídeo:</label>
                <input type="url" id="video" name="video" required>
                
                <button type="submit">Adicionar Filme</button>
            </form>
        </section>
        <section class="movie-list">
            <h2>Lista de Filmes</h2>
            <div id="movie-list-container">
                <!-- Filmes serão listados aqui -->
            </div>
        </section>
    </main>
  
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC2U69m-BT92vckB_wzziSJB9F8cCB0YBo",
            authDomain: "filme-terror.firebaseapp.com",
            databaseURL: "https://filme-terror-default-rtdb.firebaseio.com",
            projectId: "filme-terror",
            storageBucket: "filme-terror.appspot.com",
            messagingSenderId: "700657136479",
            appId: "1:700657136479:web:6c42f535edd24bd25f7cea"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);

        // Referência ao Realtime Database
        const database = firebase.database();

        // Função para carregar os filmes
        async function loadFilmes() {
            try {
                const snapshot = await database.ref('filmes').once('value');
                return snapshot.val();
            } catch (error) {
                console.error('Erro ao carregar filmes:', error);
                throw error;
            }
        }

        // Função para adicionar um filme
        async function adicionarFilme(novoFilme) {
            try {
                await database.ref('filmes').push().set(novoFilme);
                console.log('Filme adicionado com sucesso!');
                carregarListaFilmes();
            } catch (error) {
                console.error('Erro ao adicionar filme:', error);
                throw error;
            }
        }

        // Função para carregar e exibir a lista de filmes
        async function carregarListaFilmes() {
            try {
                const filmes = await loadFilmes();
                const filmesContainer = document.getElementById('movie-list-container');
                filmesContainer.innerHTML = ''; // Limpa o conteúdo atual da lista

                for (const key in filmes) {
                    if (Object.hasOwnProperty.call(filmes, key)) {
                        const filme = filmes[key];
                        const filmeElement = document.createElement('div');
                        filmeElement.classList.add('movie-item');

                        const logoImg = document.createElement('img');
                        logoImg.src = filme.logo;
                        logoImg.alt = filme.titulo;

                        const tituloElement = document.createElement('h3');
                        tituloElement.textContent = filme.titulo;

                        const descricaoElement = document.createElement('p');
                        descricaoElement.textContent = filme.descricao;

                        filmeElement.appendChild(logoImg);
                        filmeElement.appendChild(tituloElement);
                        filmeElement.appendChild(descricaoElement);

                        filmesContainer.appendChild(filmeElement);
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar lista de filmes:', error);
            }
        }

        // Captura o evento de submissão do formulário
        const addMovieForm = document.getElementById('add-movie-form');
        addMovieForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const logo = document.getElementById('logo').value;
            const video = document.getElementById('video').value;

            // Cria um objeto com os dados do novo filme
            const novoFilme = {
                titulo: title,
                descricao: description,
                logo: logo,
                video: video
            };

            // Adiciona o novo filme
            adicionarFilme(novoFilme);

            // Limpa o formulário após adicionar o filme
            addMovieForm.reset();
        });

        // Carrega a lista de filmes ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            carregarListaFilmes();
        });
    </script>
</body>
</html>
